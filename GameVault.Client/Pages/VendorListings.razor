@page "/vendor/listings"
@using GameVault.Shared.DTOs
@using GameVault.Shared.Models
@inject NavigationManager Nav

<h3>View Listings</h3>

@* TODO: Tab bar styling *@
@foreach (var listingStatus in Enum.GetValues<ListingStatus>())
{
  <button @onclick="() => {
    filter = listingStatus;
  }" class="btn mb-2 @(listingStatus == filter ? "btn-primary" : "btn-secondary")">@listingStatus</button>
}
<button @onclick='() => Nav.NavigateTo("/vendor/listings/create")' class="btn btn-secondary">Create New</button>
@* Hardcoded: *@
@* <button @onclick="TabPublished">Published</button>
<button @onclick="TabDraft">Draft</button>
<button @onclick="TabPending">Pending</button>
<button @onclick="TabRemoved">Removed</button> *@

@if (listings == null)
{
  <p><em>Loading...</em></p>
}
else if (listings.Count == 0)
{
  <p><em>No listings found with status "@filter"</em></p>
} else {
  <table class="table">
  <thead>
    <tr>
      <th>Name</th>
      <th>Price</th>
      @if (filter == ListingStatus.Published) {
        <th>Stock</th>
      }
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    @foreach (var listing in listings)
    {
      <tr>
        <td>@listing.Name</td>
        <td>@((listing.Price / 100M).ToString("C2"))</td>
        @if (filter == ListingStatus.Published) {
          <td>@listing.Stock</td>
        }
        <td>
          @if (filter == ListingStatus.Inactive || filter == ListingStatus.Removed) {
            <button @onclick='() => Nav.NavigateTo($"/listings/edit/{listing.Id}")'>Edit</button>
          }
          @if (filter == ListingStatus.Inactive) {
            <button>Submit</button>
          }
          @if (filter == ListingStatus.Pending) {
            <button>Cancel Request</button>
          }
          @if (filter == ListingStatus.Published) {
            <button>Unpublish</button>
          }
        </td>
      </tr>
    }
  </tbody>
  </table>
}

@code {
  public ListingStatus filter = 0;

  private List<ListingDTO>? listings = new List<ListingDTO> {
    new ListingDTO {
      Id = "a",
      Description="Lots of apples",
      Name="Listing A",
      OwnerID="me",
      Price=599,
      Status=ListingStatus.Published,
      Stock=5
    },
    new ListingDTO {
      Id = "b",
      Description="A few bees",
      Name="Listing B",
      OwnerID="me",
      Price=1099,
      Status=ListingStatus.Inactive,
      Stock=20
    }
  };
}