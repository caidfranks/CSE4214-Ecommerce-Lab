@page "/"
@using System.Threading.Tasks
@inject AuthService AuthService
@inject NavigationManager Navigation

<div class="home-container">
    <div class="home-card">
        <div class="auth-header">
            <h1 class="home-title">Welcome to GameVault</h1>
            <p class="home-subtitle">Games for gamers</p>
        </div>

        @if (AuthService.IsAuthenticated)
        {
            <div class="user-info">
                <div class="user-welcome">
                    <i class="bi bi-person-circle me-2"></i>
                    Welcome back, @AuthService.CurrentUser?.Name!
                </div>
                <div class="user-details">
                    <p><strong>Role:</strong> @AuthService.CurrentUser?.Type</p>
                </div>
            </div>

            <div class="home-buttons">
                @if (AuthService.CurrentUser?.Type == Shared.Models.AccountType.Admin)
                {
                    <button class="home-button home-button-secondary" @onclick="GoToAdminDashboard">
                        <i class="bi bi-shop me-2"></i>
                        Admin Dashboard
                    </button>
                }
                else
                {
                    <button class="home-button home-button-primary" @onclick="GoToGames">
                        <i class="bi bi-controller me-2"></i>
                        Browse Games
                    </button>

                    @if (AuthService.CurrentUser?.Type == Shared.Models.AccountType.Vendor)
                    {
                        <button class="home-button home-button-secondary" @onclick="GoToVendorDashboard">
                            <i class="bi bi-shop me-2"></i>
                            Vendor Dashboard
                        </button>
                    }
                }

                <button class="home-button home-button-outline" @onclick="GoToProfile">
                    <i class="bi bi-person me-2"></i>
                    My Profile
                </button>

                <button class="home-button home-button-outline" @onclick="Logout">
                    <i class="bi bi-box-arrow-right me-2"></i>
                    Logout
                </button>
            </div>
        }
        else
        {
            <div class="home-buttons">
                <button class="home-button home-button-primary" @onclick="GoToCustomerRegister">
                    <i class="bi bi-person-plus me-2"></i>
                    Join as Customer
                </button>

                <button class="home-button home-button-secondary" @onclick="GoToVendorRegister">
                    <i class="bi bi-shop me-2"></i>
                    Become a Vendor
                </button>

                <a href="/login" class="home-button home-button-outline">
                    <i class="bi bi-box-arrow-in-right me-2"></i>
                    Sign In
                </a>
            </div>

            <div class="auth-footer">
                <p class="auth-footer-text">
                    <i class="bi bi-info-circle me-2"></i>
                    New to GameVault? Create an account to start buying and selling games!
                </p>
            </div>
        }
    </div>
</div>

@code {
    private void GoToCustomerRegister() => Navigation.NavigateTo("/register/customer");
    private void GoToVendorRegister() => Navigation.NavigateTo("/register/vendor");
    private void GoToGames() => Navigation.NavigateTo("/games");
    private void GoToVendorDashboard() => Navigation.NavigateTo("/vendor");
    private void GoToAdminDashboard() => Navigation.NavigateTo("/adminLanding");
    private void GoToProfile() => Navigation.NavigateTo("/profile");

    private async Task Logout()
    {
        await AuthService.Logout();
    }

    protected override void OnInitialized()
    {
        if (AuthService.IsAuthenticated && AuthService.CurrentUser?.Type == Shared.Models.AccountType.Vendor)
        {
            Navigation.NavigateTo("/vendor", true);
            return;
        }
        else if (AuthService.IsAuthenticated && AuthService.CurrentUser?.Type == Shared.Models.AccountType.Admin)
        {
            Navigation.NavigateTo("/adminLanding", true);
            return;
        }
        else if (AuthService.IsAuthenticated && AuthService.CurrentUser?.Type == Shared.Models.AccountType.Customer)
        {
            Navigation.NavigateTo("/games", replace: true);
            return;
        }
    }
}